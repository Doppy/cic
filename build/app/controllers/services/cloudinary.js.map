{"version":3,"sources":["../../../../server/app/controllers/services/cloudinary.js"],"names":["request","require","cloudinary","fs","CLOUDINARY_CLOUDNAME","process","env","CLOUDINARY_APIKEY","CLOUDINARY_APISECRET","config","cloud_name","api_key","api_secret","upload","req","res","next","console","log","file","path","uploader","result","json","unlink","getRealParamKey","key","convertStringToObject","str","reduce","split","all","item","value","realKey","getImage","publicId","params","public_id","paramString","param","paramsObject","imgUrl","url","pipe","module","exports"],"mappings":";;;;;;AAAA;;;;;;;;AAEA,IAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA,IAAMC,aAAaD,QAAQ,YAAR,CAAnB;AACA,IAAME,KAAKF,QAAQ,IAAR,CAAX;;AAGA;AACA,IAAMG,uBAAuBC,QAAQC,GAAR,CAAYF,oBAAzC;AACA,IAAMG,oBAAoBF,QAAQC,GAAR,CAAYC,iBAAtC;AACA,IAAMC,uBAAuBH,QAAQC,GAAR,CAAYE,oBAAzC;;AAEAN,WAAWO,MAAX,CAAkB;AAChBC,cAAYN,oBADI;AAEhBO,WAASJ,iBAFO;AAGhBK,cAAYJ;AAHI,CAAlB;;AAMA,IAAMK,SAAS,SAATA,MAAS,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACjCC,UAAQC,GAAR,CAAYJ,IAAIK,IAAhB;AACA,MAAMA,OAAOL,IAAIK,IAAJ,CAASC,IAAtB;AACAlB,aAAWmB,QAAX,CAAoBR,MAApB,CAA2BM,IAA3B,EAAiC,UAACG,MAAD,EAAY;AAC3CL,YAAQC,GAAR,CAAYI,MAAZ;AACAP,QAAIQ,IAAJ,CAASD,MAAT;AACAnB,OAAGqB,MAAH,CAAUL,IAAV;AACD,GAJD;AAKD,CARD;;AAUA,IAAMM,kBAAkB,SAAlBA,eAAkB,CAACC,GAAD,EAAS;AAC/B,UAAQA,GAAR;AACE,SAAK,GAAL;AAAU,aAAO,OAAP;AACV,SAAK,GAAL;AAAU,aAAO,QAAP;AACV,SAAK,GAAL;AAAU,aAAO,MAAP;AACV,SAAK,GAAL;AAAU,aAAO,SAAP;AACV;AAAS,aAAOA,GAAP;AALX;AAOD,CARD;;AAUA,IAAMC,wBAAwB,SAAxBA,qBAAwB,CAACC,GAAD,EAAS;AACrC,SAAO,iBAAEC,MAAF,CAAS,iBAAEC,KAAF,CAAQF,GAAR,EAAa,GAAb,CAAT,EAA4B,UAACG,GAAD,EAAMC,IAAN,EAAe;AAAA,kBAC3B,iBAAEF,KAAF,CAAQE,IAAR,EAAc,GAAd,CAD2B;AAAA;AAAA,QACzCN,GADyC;AAAA,QACpCO,KADoC;;AAEhD,QAAMC,UAAUT,gBAAgBC,GAAhB,CAAhB;AACA,wBACKK,GADL,sBAEGG,OAFH,EAEaD,KAFb;AAID,GAPM,EAOJ,EAPI,CAAP;AAQD,CATD;;AAWA,IAAME,WAAW,SAAXA,QAAW,CAACrB,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACnC,MAAMoB,WAAWtB,IAAIuB,MAAJ,CAAWC,SAA5B;AACA,MAAMC,cAAczB,IAAIuB,MAAJ,CAAWG,KAA/B;AACA,MAAMC,eAAed,sBAAsBY,WAAtB,CAArB;AACA,MAAMG,SAASxC,WAAWyC,GAAX,CAAeP,QAAf,EAAyBK,YAAzB,CAAf;AACAzC,UAAQ0C,MAAR,EAAgBE,IAAhB,CAAqB7B,GAArB;AACD,CAND;;AASA8B,OAAOC,OAAP,GAAiB;AACfX,oBADe;AAEftB;AAFe,CAAjB","file":"cloudinary.js","sourcesContent":["import _ from 'lodash';\n\nconst request = require('request');\nconst cloudinary = require('cloudinary');\nconst fs = require('fs');\n\n\n/* Cloudinary */\nconst CLOUDINARY_CLOUDNAME = process.env.CLOUDINARY_CLOUDNAME;\nconst CLOUDINARY_APIKEY = process.env.CLOUDINARY_APIKEY;\nconst CLOUDINARY_APISECRET = process.env.CLOUDINARY_APISECRET;\n\ncloudinary.config({\n  cloud_name: CLOUDINARY_CLOUDNAME,\n  api_key: CLOUDINARY_APIKEY,\n  api_secret: CLOUDINARY_APISECRET,\n});\n\nconst upload = (req, res, next) => {\n  console.log(req.file);\n  const file = req.file.path;\n  cloudinary.uploader.upload(file, (result) => {\n    console.log(result);\n    res.json(result);\n    fs.unlink(file);\n  });\n};\n\nconst getRealParamKey = (key) => {\n  switch (key) {\n    case 'w': return 'width';\n    case 'h': return 'height';\n    case 'c': return 'crop';\n    case 'g': return 'gravity';\n    default: return key;\n  }\n}\n\nconst convertStringToObject = (str) => {\n  return _.reduce(_.split(str, ','), (all, item) => {\n    const [key, value] = _.split(item, '_');\n    const realKey = getRealParamKey(key);\n    return {\n      ...all,\n      [realKey]: value,\n    }\n  }, {});\n}\n\nconst getImage = (req, res, next) => {\n  const publicId = req.params.public_id;\n  const paramString = req.params.param;\n  const paramsObject = convertStringToObject(paramString);\n  const imgUrl = cloudinary.url(publicId, paramsObject);\n  request(imgUrl).pipe(res);\n};\n\n\nmodule.exports = {\n  getImage,\n  upload,\n}\n"]}
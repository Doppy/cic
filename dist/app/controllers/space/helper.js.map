{"version":3,"sources":["../../../../server/app/controllers/space/helper.js"],"names":["_","require","exports","handleError","err","next","console","error","validateField","value","contentTypeField","log","required","isEmpty","name","get","includes","validations","in","join","fieldType","size","min","max","range","undefined","validateFields","fields","contentType","errors","compact","map","fieldValue","identifier","valid","message"],"mappings":";;AAAA,IAAMA,IAAIC,QAAQ,QAAR,CAAV;;AAEAC,QAAQC,WAAR,GAAsB,UAACC,GAAD,EAAMC,IAAN,EAAe;AACnCC,UAAQC,KAAR,CAAcH,GAAd;AACA,SAAOC,KAAKD,GAAL,CAAP;AACD,CAHD;AAIA;;;AAGA,IAAMI,gBAAgB,SAAhBA,aAAgB,CAACC,KAAD,EAAQC,gBAAR,EAA6B;AACjDJ,UAAQK,GAAR,CAAY,eAAZ,EAA6BF,KAA7B,EAAoCC,gBAApC;AACA;AACA,MAAIA,iBAAiBE,QAAjB,IAA6BZ,EAAEa,OAAF,CAAUJ,KAAV,CAAjC,EAAmD,OAAUC,iBAAiBI,IAA3B;;AAEnD;AACA,MAAI,CAACd,EAAEa,OAAF,CAAUb,EAAEe,GAAF,CAAML,gBAAN,EAAwB,gBAAxB,CAAV,CAAL,EAA2D;AACzD,QAAI,CAACV,EAAEgB,QAAF,CAAWN,iBAAiBO,WAAjB,CAA6BC,EAAxC,EAA4CT,KAA5C,CAAL,EAAyD,OAAUC,iBAAiBI,IAA3B,wBAAkDd,EAAEmB,IAAF,CAAOT,iBAAiBO,WAAjB,CAA6BC,EAApC,EAAwC,GAAxC,CAAlD;AAC1D;;AAED;AACA;AACA;;AAEA;AACA,MAAIlB,EAAEgB,QAAF,CAAW,CAAC,OAAD,EAAU,QAAV,CAAX,EAAgCN,iBAAiBU,SAAjD,KAA+D,CAACpB,EAAEa,OAAF,CAAUH,iBAAiBW,IAA3B,CAApE,EAAsG;AACpG,QAAMC,MAAMtB,EAAEe,GAAF,CAAML,gBAAN,EAAwB,sBAAxB,CAAZ;AACA,QAAMa,MAAMvB,EAAEe,GAAF,CAAML,gBAAN,EAAwB,sBAAxB,CAAZ;AACA,QAAIV,EAAEqB,IAAF,CAAOZ,KAAP,IAAgBa,GAAhB,IAAuBtB,EAAEqB,IAAF,CAAOZ,KAAP,IAAgBc,GAA3C,EAAgD,OAAUb,iBAAiBI,IAA3B,gCAA0DQ,GAA1D,aAAqEC,GAArE;AACjD;;AAED;AACA,MAAIb,iBAAiBU,SAAjB,KAA+B,QAA/B,IAA2C,CAACpB,EAAEa,OAAF,CAAUH,iBAAiBc,KAA3B,CAAhD,EAAmF;AACjF,QAAMF,OAAMtB,EAAEe,GAAF,CAAML,gBAAN,EAAwB,uBAAxB,CAAZ;AACA,QAAMa,OAAMvB,EAAEe,GAAF,CAAML,gBAAN,EAAwB,uBAAxB,CAAZ;AACA,QAAIV,EAAEqB,IAAF,CAAOZ,KAAP,IAAgBa,IAAhB,IAAuBtB,EAAEqB,IAAF,CAAOZ,KAAP,IAAgBc,IAA3C,EAAgD,OAAUb,iBAAiBI,IAA3B,iCAA2DQ,IAA3D,aAAsEC,IAAtE;AACjD;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,SAAOE,SAAP;AACD,CA1CD;;AA4CAvB,QAAQwB,cAAR,GAAyB,UAACC,MAAD,EAASC,WAAT,EAAyB;AAChD,MAAMC,SAAS7B,EAAE8B,OAAF,CAAU9B,EAAE+B,GAAF,CAAMH,YAAYD,MAAlB,EAA0B,UAACjB,gBAAD,EAAsB;AACvE,QAAMsB,aAAahC,EAAEe,GAAF,CAAMY,MAAN,EAAcjB,iBAAiBuB,UAA/B,CAAnB;AACA,WAAOzB,cAAcwB,UAAd,EAA0BtB,gBAA1B,CAAP;AACD,GAHwB,CAAV,CAAf;AAIA,SAAOV,EAAEqB,IAAF,CAAOQ,MAAP,IAAiB,CAAjB,GAAqB,EAAEK,OAAO,KAAT,EAAgBC,SAASN,MAAzB,EAArB,GAAyD,EAAEK,OAAO,IAAT,EAAeC,SAAS,EAAxB,EAAhE;AACD,CAND","file":"helper.js","sourcesContent":["const _ = require('lodash');\n\nexports.handleError = (err, next) => {\n  console.error(err);\n  return next(err);\n};\n/**\n * Field Validation Helpers\n */\nconst validateField = (value, contentTypeField) => {\n  console.log('validateField', value, contentTypeField);\n  // Check require\n  if (contentTypeField.required && _.isEmpty(value)) return `${contentTypeField.name} is required`;\n\n  // Check 'in'\n  if (!_.isEmpty(_.get(contentTypeField, 'validations.in'))) {\n    if (!_.includes(contentTypeField.validations.in, value)) return `${contentTypeField.name} must be one of ${_.join(contentTypeField.validations.in, ',')}`;\n  }\n\n  // Check MIME\n  // TODO\n  // if (contentTypeField.fieldType === 'assets' && )\n\n  // Size (Array, String)\n  if (_.includes(['Array', 'String'], contentTypeField.fieldType) && !_.isEmpty(contentTypeField.size)) {\n    const min = _.get(contentTypeField, 'validations.size.min');\n    const max = _.get(contentTypeField, 'validations.size.max');\n    if (_.size(value) < min || _.size(value) > max) return `${contentTypeField.name} size should be between ${min} and ${max}`;\n  }\n\n  // Range (Number)\n  if (contentTypeField.fieldType === 'Number' && !_.isEmpty(contentTypeField.range)) {\n    const min = _.get(contentTypeField, 'validations.range.min');\n    const max = _.get(contentTypeField, 'validations.range.max');\n    if (_.size(value) < min || _.size(value) > max) return `${contentTypeField.name} range should be between ${min} and ${max}`;\n  }\n\n  // RegExp\n  // TODO\n  // if (!_.isEmpty(_.get(contentTypeField, 'validations.regexp'))) {\n  //   const pattern = _.get(contentTypeField, 'validations.regexp.pattern');\n  //   const flags = _.get(contentTypeField, 'validations.regexp.flags');\n  //\n  //   const re = new RegExp(pattern, flags);\n  //   if (!re.test(value)) return `${contentTypeField.name} regular expression fail`;\n  // }\n\n  // Unique\n  // TODO\n\n  return undefined;\n};\n\nexports.validateFields = (fields, contentType) => {\n  const errors = _.compact(_.map(contentType.fields, (contentTypeField) => {\n    const fieldValue = _.get(fields, contentTypeField.identifier);\n    return validateField(fieldValue, contentTypeField);\n  }));\n  return _.size(errors) > 0 ? { valid: false, message: errors } : { valid: true, message: '' };\n};\n"]}